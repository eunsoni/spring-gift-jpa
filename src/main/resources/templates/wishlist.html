<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wishlist</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<h1>Wishlist</h1>
<table id="wishlistTable" border="1">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Image</th>
        <th>Actions</th>
    </tr>
</table>
<script>
    window.onload = function() {
        console.log("wishlist onload 실행 확인");
        const token = localStorage.getItem("token");
        if (!token) {
            alert("Please log in first");
            location.href = "/login";
            return;
        }

        $.ajax({
            type: 'GET',
            url: '/api/wishlist',
            dataType: 'json',
            contentType: 'application/json; charset=UTF-8',
            headers: {
                "Authorization": "Bearer " + token
            }
        }).done(function(data) {
            const wishlistTable = document.getElementById('wishlistTable');
            data.forEach(function(item) {
                const row = wishlistTable.insertRow();
                row.insertCell(0).innerText = item.id;
                row.insertCell(1).innerText = item.name;
                row.insertCell(2).innerText = item.price;
                const imgCell = row.insertCell(3);
                const img = document.createElement('img');
                img.src = item.imageUrl;
                img.style.maxWidth = "100px";
                img.style.maxHeight = "100px";
                imgCell.appendChild(img);
                const actionsCell = row.insertCell(4);
                const deleteButton = document.createElement('button');
                deleteButton.innerText = "Delete";
                deleteButton.onclick = function() {
                    deleteWishlistItem(item.id);
                };
                actionsCell.appendChild(deleteButton);
            });
        }).fail(function() {
            alert('Failed to load wishlist');
        });
    };

    function deleteWishlistItem(itemId) {
        const token = localStorage.getItem("token");
        $.ajax({
            type: 'DELETE',
            url: '/api/wishlist/' + itemId,
            headers: {
                "Authorization": "Bearer " + token
            }
        }).done(function() {
            alert('Item deleted');
            location.reload();
        }).fail(function() {
            alert('Failed to delete item');
        });
    }
</script>
</body>
</html>
